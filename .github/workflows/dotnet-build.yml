name: .NET Build

on:
  push:
    branches:
      - main
    paths:
      - 'Part 2 - Project Creation/**'
      - 'Part 6 - Deployment/**'
      - 'Part 7 - MCP Server Basics/**'
      - 'Part 8 - Enhanced MCP Server/**'
      - 'src/start/**'
  pull_request:
    branches:
      - main
    paths:
      - 'Part 2 - Project Creation/**'
      - 'Part 6 - Deployment/**'
      - 'Part 7 - MCP Server Basics/**'
      - 'Part 8 - Enhanced MCP Server/**'
      - 'src/start/**'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        include:
          - solution: "Part 2 - Project Creation/GenAiLab/GenAiLab.sln"
            dotnet-version: '9.0.x'
          - solution: "Part 6 - Deployment/GenAiLab/GenAiLab.sln"
            dotnet-version: '9.0.x'
          # Codespaces starting solution
          - solution: "src/start/GenAiLab/GenAiLab.sln"
            dotnet-version: '9.0.x'
          # No solution file exists for MyMcpServer; using project file directly
          - solution: "Part 7 - MCP Server Basics/MyMcpServer/MyMcpServer.csproj"
            dotnet-version: '9.0.x'
          # No solution file exists for ContosoOrdersMcpServer; using project file directly
          - solution: "Part 8 - Enhanced MCP Server/ContosoOrdersMcpServer/ContosoOrdersMcpServer.csproj"
            dotnet-version: '9.0.x'

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: ${{ matrix.dotnet-version }}

    - name: Restore dependencies
      run: dotnet restore "${{ matrix.solution }}"

    - name: Build solution
      run: dotnet build "${{ matrix.solution }}" --no-restore --configuration Release
